{
	"info": {
		"_postman_id": "a8f5b4a1-1c3d-4b7e-8b1a-9c2c7f6d3b1e",
		"name": "ChatApp Backend API - Final",
		"description": "Complete and validated API collection for the ChatApp backend. Includes comprehensive success and failure test cases for all major endpoints.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{jwt_token}}",
				"type": "string"
			}
		]
	},
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080",
			"type": "string"
		},
		{
			"key": "keycloak_url",
			"value": "http://localhost:9090",
			"type": "string"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "chat_id",
			"value": "1",
			"type": "string"
		}
	],
	"item": [
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Get Token (Success)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    pm.collectionVariables.set('jwt_token', pm.response.json().access_token);",
									"}"
								]
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password"
								},
								{
									"key": "client_id",
									"value": "chatapp-client"
								},
								{
									"key": "username",
									"value": "testuser"
								},
								{
									"key": "password",
									"value": "password"
								},
								{
									"key": "client_secret",
									"value": "aSuperSecretValue"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/chatspot-chatapp/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"chatspot-chatapp",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					}
				},
				{
					"name": "Get Token (Invalid Credentials - Failure)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded"
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "password"
								},
								{
									"key": "client_id",
									"value": "chatapp-client"
								},
								{
									"key": "username",
									"value": "testuser"
								},
								{
									"key": "password",
									"value": "wrongpassword"
								},
								{
									"key": "client_secret",
									"value": "aSuperSecretValue"
								}
							]
						},
						"url": {
							"raw": "{{keycloak_url}}/realms/chatspot-chatapp/protocol/openid-connect/token",
							"host": [
								"{{keycloak_url}}"
							],
							"path": [
								"realms",
								"chatspot-chatapp",
								"protocol",
								"openid-connect",
								"token"
							]
						}
					}
				}
			]
		},
		{
			"name": "User Management",
			"item": [
				{
					"name": "Get User Profile (Success)",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/users/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"profile"
							]
						}
					}
				},
				{
					"name": "Get User Profile (No Auth - Failure)",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/users/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"profile"
							]
						}
					}
				},
				{
					"name": "Update User Profile",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],

                       "body": {
                            "mode": "formdata",
                            "formdata": [
                              {
                                "key": "firstName",
                                "value": "Put firstname here"
                              },
                              {
                                "key": "lastName",
                                "value": "Put lastname here"
                              },
                              {
                                "key": "profilePicture",
                                "type": "file",
                                "src": "/path/to/your/image.jpg"
                              }
                            ]
                        },
						"url": {
							"raw": "{{base_url}}/api/users/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"profile"
							]
						}
					}
				},
				{
					"name": "Search Users",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/users/search?query=john",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"search"
							],
							"query": [
								{
									"key": "query",
									"value": "john"
								}
							]
						}
					}
				}
			]
		},
		{
			"name": "Chat Management",
			"item": [
				{
					"name": "Get User Chats",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/chats?page=0&size=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chats"
							],
							"query": [
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "20"
								}
							]
						}
					}
				},
				{
					"name": "Get Specific Chat",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/chats/{{chat_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chats",
								"{{chat_id}}"
							]
						}
					}
				},
				{
					"name": "Create Individual Chat",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"participantId\": \"another-user-id-from-keycloak\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chats/individual",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chats",
								"individual"
							]
						}
					}
				},
				{
					"name": "Create Group Chat",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Team Chat\",\n    \"description\": \"Project discussion group\",\n    \"participantIds\": [\"user2-id\", \"user3-id\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/chats/group",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"chats",
								"group"
							]
						}
					}
				}
			]
		},
		{
			"name": "Messaging",
			"item": [
				{
					"name": "Get Chat Messages",
					"request": {
						"method": "GET",
						"url": {
							"raw": "{{base_url}}/api/messages/chat/{{chat_id}}?page=0&size=20",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"chat",
								"{{chat_id}}"
							],
							"query": [
								{
									"key": "page",
									"value": "0"
								},
								{
									"key": "size",
									"value": "20"
								}
							]
						}
					}
				},
				{
					"name": "Send Text Message (Success)",
					"request": {
						"method": "POST",
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "type",
									"value": "TEXT"
								},
								{
									"key": "text",
									"value": "Hello from Postman!"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/messages/chat/{{chat_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"chat",
								"{{chat_id}}",
								"send"
							]
						}
					}
				},
				{
					"name": "Send Media Message (Success)",
					"request": {
						"method": "POST",
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "type",
									"value": "MEDIA"
								},
								{
									"key": "media",
									"type": "file",
									"src": "/path/to/your/image.jpg"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/messages/chat/{{chat_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"chat",
								"{{chat_id}}",
								"send"
							]
						}
					}
				},
				{
					"name": "Send Message to Invalid Chat (Forbidden - Failure)",
					"request": {
						"method": "POST",
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "type",
									"value": "TEXT"
								},
								{
									"key": "text",
									"value": "This should fail."
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/messages/chat/9999/send",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"messages",
								"chat",
								"9999",
								"send"
							]
						}
					}
				}
			]
		},
      {
        "name": "Subscribe to Chat Messages (WebSocket)",
        "request": {
          "method": "GET",
          "url": {
            "raw": "ws://localhost:8080/ws/websocket",
            "protocol": "ws",
            "host": ["localhost"],
            "port": "8080",
            "path": ["ws", "websocket"]
          },
          "header": [
            {
              "key": "Authorization",
              "value": "Bearer {{jwt_token}}"
            }
          ]
        },
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "// After connecting, send a STOMP SUBSCRIBE frame to /topic/chat/{{chat_id}}",
                "// Example:",
                "// SUBSCRIBE\\nid:sub-0\\ndestination:/topic/chat/{{chat_id}}\\n\\u0000"
              ]
            }
          }
        ]
      },
      {
        "name": "Subscribe to Typing Indicator (WebSocket)",
        "request": {
          "method": "GET",
          "url": {
            "raw": "ws://localhost:8080/ws/websocket",
            "protocol": "ws",
            "host": ["localhost"],
            "port": "8080",
            "path": ["ws", "websocket"]
          },
          "header": [
            {
              "key": "Authorization",
              "value": "Bearer {{jwt_token}}"
            }
          ]
        },
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "// After connecting, send a STOMP SUBSCRIBE frame to /topic/chat/{{chat_id}}/typing",
                "// Example:",
                "// SUBSCRIBE\\nid:sub-1\\ndestination:/topic/chat/{{chat_id}}/typing\\n\\u0000"
              ]
            }
          }
        ]
      },
      {
        "name": "Subscribe to Message Reactions (WebSocket)",
        "request": {
          "method": "GET",
          "url": {
            "raw": "ws://localhost:8080/ws/websocket",
            "protocol": "ws",
            "host": ["localhost"],
            "port": "8080",
            "path": ["ws", "websocket"]
          },
          "header": [
            {
              "key": "Authorization",
              "value": "Bearer {{jwt_token}}"
            }
          ]
        },
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "// After connecting, send a STOMP SUBSCRIBE frame to /topic/message/{{message_id}}/reactions",
                "// Example:",
                "// SUBSCRIBE\\nid:sub-2\\ndestination:/topic/message/{{message_id}}/reactions\\n\\u0000"
              ]
            }
          }
        ]
      },
      {
        "name": "Subscribe to Delivery Status (WebSocket)",
        "request": {
          "method": "GET",
          "url": {
            "raw": "ws://localhost:8080/ws/websocket",
            "protocol": "ws",
            "host": ["localhost"],
            "port": "8080",
            "path": ["ws", "websocket"]
          },
          "header": [
            {
              "key": "Authorization",
              "value": "Bearer {{jwt_token}}"
            }
          ]
        },
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "// After connecting, send a STOMP SUBSCRIBE frame to /topic/message/{{message_id}}/delivery",
                "// Example:",
                "// SUBSCRIBE\\nid:sub-3\\ndestination:/topic/message/{{message_id}}/delivery\\n\\u0000"
              ]
            }
          }
        ]
      }
	]
}
